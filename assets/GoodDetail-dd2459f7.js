import{g as A,h as B,i as k,k as I,l as q,m as N,n as Q,r as u,j as o,L as T}from"./index-e7c6efce.js";import{C as G,P as R}from"./CatalogCard-860d357a.js";import{M as f,D as z}from"./Modal-51953c50.js";import{I as H,g as J}from"./getTotalCost-3a0eca4f.js";const K="_btnBox_8cpvn_1",U={btnBox:K},Z=()=>{const{goodId:l}=A(),g=B(),{data:e,isLoading:h}=k(l),[j,{isLoading:b}]=I(),{data:y,isLoading:C,refetch:O}=q(void 0),p=y?.orders,[L,{isLoading:P}]=N(),[M,{isLoading:w}]=Q(),[D,d]=u.useState(!1),[E,n]=u.useState(!1),[r,m]=u.useState(1);async function F(){const s=p.find(t=>!t.paid),a={...e};try{if(s){const t={...s};t.products=[...t.products];let x;const i=t.products.find((c,v)=>{if(c._id===l)return x=v,!0});if(i){const c={...i,amount:i.amount+r};t.products[x]=c}else a.amount=r,t.products.push(a);t.totalCost=J(t.products),delete t._id,await M({id:s._id,body:t}).unwrap();return}else{const t={};t.date=new Date,t.paid=!1,t.products=[a],t.products[0].amount=r,t.totalCost=r*e.price,await L(t)}}catch(t){console.log(t)}finally{O(),m(1)}}function S(s){m(s)}async function _(s){s.preventDefault(),await j(e._id),g(-1)}return o.jsxs(o.Fragment,{children:[h||P||w||b||C&&o.jsx(T,{}),e?o.jsxs(o.Fragment,{children:[o.jsx(G,{item:e}),o.jsxs("div",{className:U.btnBox,children:[o.jsx(H,{increment:S,quantity:r,limit:e.quantity}),o.jsx("button",{type:"button",onClick:()=>F(),title:"Add to Order",disabled:!p,children:"Add to Order"}),o.jsx("button",{type:"button",onClick:()=>d(!0),title:"Edit Product",children:"Edit Product"}),o.jsx("button",{type:"button",onClick:()=>n(!0),children:"Del Product"})]}),D&&o.jsxs(f,{onClose:()=>d(!1),children:[o.jsx(o.Fragment,{}),o.jsx(R,{onClose:()=>d(!1),product:e})]}),E&&o.jsxs(f,{onClose:()=>n(!1),children:[o.jsx(o.Fragment,{}),o.jsx(z,{subject:"product",onSubmit:_,onClose:()=>n(!1)})]})]}):o.jsx("h2",{children:"This product no longer exist"})]})};export{Z as default};
