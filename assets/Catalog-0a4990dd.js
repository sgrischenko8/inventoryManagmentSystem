import{r as F,c as H,u as me,a as fe,b as he,d as ge,e as be,f as xe,j as n,L as ye,s as ve}from"./index-e7c6efce.js";import{M as se,D as Ce}from"./Modal-51953c50.js";import{C as ce,P as pe}from"./CatalogCard-860d357a.js";const _e="_catalogWrapper_1uo2w_1",je="_filterCatalogForm_1uo2w_19",we="_priceSection_1uo2w_119",Se="_priceRange_1uo2w_138",Ee="_bar_1uo2w_152",Me="_caption_1uo2w_164",Le="_thumb_1uo2w_167",Ve="_top5_1uo2w_181",Ne="_productSection_1uo2w_204",A={catalogWrapper:_e,filterCatalogForm:je,priceSection:we,priceRange:Se,bar:Ee,"bar-left":"_bar-left_1uo2w_156","bar-right":"_bar-right_1uo2w_160",caption:Me,thumb:Le,"thumb-right":"_thumb-right_1uo2w_174",top5:Ve,productSection:Ne};var de={};var Te=H&&H.__createBinding||(Object.create?function(t,y,x,m){m===void 0&&(m=x),Object.defineProperty(t,m,{enumerable:!0,get:function(){return y[x]}})}:function(t,y,x,m){m===void 0&&(m=x),t[m]=y[x]}),Fe=H&&H.__setModuleDefault||(Object.create?function(t,y){Object.defineProperty(t,"default",{enumerable:!0,value:y})}:function(t,y){t.default=y}),Re=H&&H.__importStar||function(t){if(t&&t.__esModule)return t;var y={};if(t!=null)for(var x in t)x!=="default"&&Object.prototype.hasOwnProperty.call(t,x)&&Te(y,t,x);return Fe(y,t),y};Object.defineProperty(de,"__esModule",{value:!0});const u=Re(F);let oe=null,ue=null;const Xe=(t,y)=>{let x=t.ruler===void 0||t.ruler===null?!0:t.ruler,m=t.label===void 0||t.label===null?!0:t.label,R=t.subSteps===void 0||t.subSteps===null?!1:t.subSteps,B=t.stepOnly===void 0||t.stepOnly===null?!1:t.stepOnly,X=t.preventWheel===void 0||t.preventWheel===null?!1:t.preventWheel,P=(0,u.useRef)(null),i=+(t.min||0),o=+(t.max||100),s=Math.abs(+(t.step||5)),E=0,C=!!t.disabled,f=t.canMinMaxValueSame?0:s,G=Math.floor((+o-+i)/+s),k=t.labels||[];k.length===0?(k=[],k.push(i.toString()),k.push(o.toString())):G=k.length-1,typeof m=="string"&&(m=m==="true"),typeof x=="string"&&(x=x==="true"),typeof X=="string"&&(X=X==="true"),s.toString().includes(".")&&(E=2);let p=t.minValue;p==null&&(p=25),p=+p;let _=t.maxValue;_==null&&(_=75),_=+_,p<i&&(p=i),p>o&&(p=o),_<p&&(_=+p+ +s),_>o&&(_=o),_<i&&(_=i);const[h,M]=(0,u.useState)(+p),[d,w]=(0,u.useState)(+_),[I,$]=(0,u.useState)((h-i)/(o-i)*100),[z,Y]=(0,u.useState)((o-d)/(o-i)*100),[J,q]=(0,u.useState)(""),[U,Z]=(0,u.useState)(""),[T,g]=(0,u.useState)(!0),Q=e=>{if(C)return;let a=h-s;a<i&&(a=i),M(a)},S=e=>{if(C)return;let a=parseFloat(e.target.value);a>d-f&&(a=d-f),M(a),g(!0)},K=e=>{if(C)return;let a=e.clientX,D=e.target.parentNode.getBoundingClientRect(),O=h;g(!1);let L=N=>{let W=(N.clientX-a)/D.width,r=O+(o-i)*W;B&&(r=Math.round(r/s)*s),r=parseFloat(r.toFixed(E)),r<i?r=i:r>d-f&&(r=d-f),M(r)},V=N=>{g(!0),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",V)};document.addEventListener("mousemove",L),document.addEventListener("mouseup",V)},ee=e=>{if(C)return;let a=e.touches[0].clientX,D=e.target.parentNode.getBoundingClientRect(),O=h;g(!1);let L=N=>{let W=(N.touches[0].clientX-a)/D.width,r=O+(o-i)*W;B&&(r=Math.round(r/s)*s),r=parseFloat(r.toFixed(E)),r<i?r=i:r>d-f&&(r=d-f),M(r)},V=N=>{g(!0),document.removeEventListener("touchmove",L),document.removeEventListener("touchend",V)};document.addEventListener("touchmove",L),document.addEventListener("touchend",V)},te=e=>{if(C)return;let a=h+s;a>d-f&&(a=d-f),M(a)},ae=e=>{if(C)return;let a=d-s;a<h+f&&(a=h+f),w(a)},ne=e=>{if(C)return;let a=parseFloat(e.target.value);a<h+f&&(a=h+f),w(a),g(!0)},le=e=>{if(C)return;let a=e.clientX,D=e.target.parentNode.getBoundingClientRect(),O=d;g(!1);let L=N=>{let W=(N.clientX-a)/D.width,r=O+(o-i)*W;B&&(r=Math.round(r/s)*s),r=parseFloat(r.toFixed(E)),r<h+f?r=h+f:r>o&&(r=o),w(r)},V=N=>{g(!0),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",V)};document.addEventListener("mousemove",L),document.addEventListener("mouseup",V)},l=e=>{if(C)return;let a=e.touches[0].clientX,D=e.target.parentNode.getBoundingClientRect(),O=d;g(!1);let L=N=>{let W=(N.touches[0].clientX-a)/D.width,r=O+(o-i)*W;B&&(r=Math.round(r/s)*s),r=parseFloat(r.toFixed(E)),r<h+f?r=h+f:r>o&&(r=o),w(r)},V=N=>{g(!0),document.removeEventListener("touchmove",L),document.removeEventListener("touchend",V)};document.addEventListener("touchmove",L),document.addEventListener("touchend",V)},c=e=>{if(C)return;let a=d+s;a>o&&(a=o),w(a)},j=e=>{if(C||X===!0||!e.shiftKey&&!e.ctrlKey)return;let a=(o-i)/100;a>1&&(a=1),e.deltaY<0&&(a=-a);let b=h,v=d;e.shiftKey&&e.ctrlKey?b+a>=i&&v+a<=o&&(b=b+a,v=v+a):e.ctrlKey?(a=v+a,a<b+f?a=b+f:a>o&&(a=o),v=a):e.shiftKey&&(a=b+a,a<i?a=i:a>v-f&&(a=v-f),b=a),g(!1),w(v),M(b),oe&&window.clearTimeout(oe),oe=window.setTimeout(()=>{g(!0)},100)};return(0,u.useEffect)(()=>{P&&P.current&&P.current.parentNode.addEventListener("wheel",b=>{!b.shiftKey&&!b.ctrlKey||b.preventDefault()})},[P]),(0,u.useEffect)(()=>{if(d<h)throw new Error("maxValue is less than minValue");const e=()=>{let v={min:i,max:o,minValue:h,maxValue:d};T&&t.onChange&&t.onChange(v),t.onInput&&t.onInput(v)};q(t.minCaption||h.toFixed(E)),Z(t.maxCaption||d.toFixed(E));let a=(h-i)/(o-i)*100;$(a);let b=(o-d)/(o-i)*100;Y(b),ue&&window.clearTimeout(ue),ue=window.setTimeout(e,20)},[h,d,i,o,E,t,T]),(0,u.useEffect)(()=>{let e=t.minValue;e==null&&(e=25),e=+e,e<i&&(e=i),e>o&&(e=o),g(!1),M(+e)},[t.minValue,i,o]),(0,u.useEffect)(()=>{let e=t.maxValue;e==null&&(e=75),e=+e,e>o&&(e=o),e<i&&(e=i),g(!1),w(+e)},[t.maxValue,i,o,s]),u.default.createElement("div",{ref:y,id:t.id,className:(t.baseClassName||"multi-range-slider")+" "+(t.className||"")+(C?" disabled":""),style:t.style,onWheel:j},u.default.createElement("div",{className:"bar",ref:P},u.default.createElement("div",{className:"bar-left",style:{width:I+"%",backgroundColor:t.barLeftColor},onClick:Q}),u.default.createElement("input",{placeholder:"min-value",className:"input-type-range input-type-range-min",type:"range",min:i,max:o,step:s,value:h,onInput:S}),u.default.createElement("div",{className:"thumb thumb-left",style:{backgroundColor:t.thumbLeftColor},onMouseDown:K,onTouchStart:ee},u.default.createElement("div",{className:"caption"},u.default.createElement("span",{className:"min-caption"},J))),u.default.createElement("div",{className:"bar-inner",style:{backgroundColor:t.barInnerColor}},u.default.createElement("div",{className:"bar-inner-left",onClick:te}),u.default.createElement("div",{className:"bar-inner-right",onClick:ae})),u.default.createElement("input",{placeholder:"max-value",className:"input-type-range input-type-range-max",type:"range",min:i,max:o,step:s,value:d,onInput:ne}),u.default.createElement("div",{className:"thumb thumb-right",style:{backgroundColor:t.thumbRightColor},onMouseDown:le,onTouchStart:l},u.default.createElement("div",{className:"caption"},u.default.createElement("span",{className:"max-caption"},U))),u.default.createElement("div",{className:"bar-right",style:{width:z+"%",backgroundColor:t.barRightColor},onClick:c})),x&&u.default.createElement("div",{className:"ruler"},[...Array(G)].map((e,a)=>u.default.createElement("div",{key:a,className:"ruler-rule"},R&&[...Array(10)].map((b,v)=>u.default.createElement("div",{key:v,className:"ruler-sub-rule"}))))),m&&u.default.createElement("div",{className:"labels"},k.map(e=>u.default.createElement("div",{key:e.toString(),className:"label"},e))))};var Pe=de.default=u.default.memo((0,u.forwardRef)(Xe));const De=()=>{const[t,y]=me(),x=t.get("query"),m=F.useMemo(()=>Object.fromEntries([...t]),[t]),{data:R,isLoading:B,refetch:X}=fe(!0),{data:P,isLoading:i,refetch:o}=he(m||void 0),s=P?.products,E=P?.top5,[C,{isLoading:f}]=ge(),[G,{isLoading:k}]=be(),[p,{isLoading:_}]=xe(),[h,M]=F.useState(!1),[d,w]=F.useState(""),[I,$]=F.useState(""),[z,Y]=F.useState(""),[J,q]=F.useState(!1);function U(l){const c=m.category;return!!(c&&c.includes(l))}function Z(){const l=+m.price_min;return l||0}function T(){if(!s)return 1e4;const l=s.map(c=>c.price);return Math.max(...l)}const[g,Q]=F.useState(Z()),[S,K]=F.useState();F.useEffect(()=>{S&&S>=T()||K(T())},[m]);function ee(l){let c={},j=m.category;if(j&&j.includes(l)){const e=j.replace(`&category=${l}`,"").replace(`${l}&category=`,"").replace(l,"");c={...m,category:e},e===""&&delete c.category}else c={...m,category:j?j+"&category="+l:l};y(c)}const te=l=>{l?.preventDefault();let c={};g!==0&&(c.price_min=g.toString()),S!==T()&&(c.price_max=S?S.toString():T().toString()),y({...m,...c})};async function ae(l){const c=l.target,j=c.value;if(j.trim()===""||R.includes(j)){$("");return}try{const e={id:I,body:{name:c.value}};await p(e).unwrap(),X()}catch(e){console.log(e)}$("")}async function ne(l){const j=l.target.value;if(j.trim()===""||R.includes(j)){M(!1);return}try{await C({name:j}).unwrap(),X()}catch(e){console.log(e)}M(!1)}async function le(l){l.preventDefault();try{await G(d),w(""),X()}catch(c){console.log(c)}}return n.jsxs(n.Fragment,{children:[(B||i||f||k||_)&&n.jsx(ye,{}),!B&&s&&n.jsxs("div",{className:A.catalogWrapper,children:[n.jsxs("aside",{children:[d&&n.jsxs(se,{onClose:()=>w(""),children:[n.jsx(n.Fragment,{}),n.jsx(Ce,{subject:"category",onSubmit:le,onClose:()=>w("")})]}),n.jsxs("form",{onSubmit:te,id:"filter",className:A.filterCatalogForm,children:[n.jsx("button",{type:"button",onClick:()=>M(!0),title:"Add new category",children:"+"}),n.jsx("ul",{children:!I&&R?.map(l=>n.jsx("li",{children:n.jsx("button",{type:"button",onClick:()=>w(l._id),title:"Delete Category",children:"X"})},l._id))}),n.jsx("ul",{children:!I&&R?.map((l,c)=>n.jsx("li",{children:n.jsx("button",{type:"button",title:"Rename Category",onClick:()=>{Y(R[c].name),$(l._id)},children:n.jsx("svg",{width:16,height:16,children:n.jsx("use",{href:`${ve}#edit`})})})},l._id))}),n.jsxs("fieldset",{children:[n.jsx("legend",{children:"Categories:"}),R?.map(l=>n.jsx("label",{children:I&&I===l._id?n.jsx("input",{type:"text",name:"renameCategory",value:z,onChange:c=>Y(c.target.value),onBlur:ae,autoFocus:!0}):n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"checkbox",name:"cat",value:l._id,checked:U(l._id),onChange:()=>ee(l._id)}),l.name,l?.amount?` (${l.amount})`:""]})},l._id)),h&&n.jsx("input",{type:"text",name:"newCategory",autoFocus:!0,onBlur:ne})]}),n.jsxs("fieldset",{className:A.priceSection,children:[n.jsx("legend",{children:"Price"}),n.jsxs("div",{children:[n.jsx("span",{children:"From"}),n.jsx("span",{children:"To"})]}),n.jsxs("div",{children:[n.jsx("label",{children:n.jsx("input",{type:"number",name:"price_min",max:S,value:g,onChange:l=>{S&&+l.target.value>S||Q(+l.target.value)},placeholder:"0",min:"0"})}),n.jsx("label",{children:n.jsx("input",{type:"number",name:"price_max",value:S,onChange:l=>{+l.target.value<g||K(+l.target.value)},placeholder:T().toString(),min:g})})]}),n.jsx(Pe,{min:0,max:T(),minValue:g,maxValue:S,onInput:l=>{Q(l.minValue),K(l.maxValue)},canMinMaxValueSame:!0,ruler:!1,label:!1,barLeftColor:"#a7a5a3",barInnerColor:"#101010",barRightColor:"#a7a5a3",thumbLeftColor:"#101010",thumbRightColor:"#101010",style:{border:"none",boxShadow:"none",width:"100%"},className:A.priceRange})]}),n.jsxs("div",{children:[n.jsx("button",{type:"reset",form:"filter",onClick:()=>{Q(0),K(T()),y(x?{query:x}:{})},children:"Clear"}),n.jsx("button",{type:"submit",onClick:()=>!1,children:"Search"})]})]}),E?.length>0&&n.jsxs("div",{className:A.top5,children:[n.jsx("h3",{children:"Top 5 BestSellers"}),n.jsx("ul",{children:E.map(l=>n.jsx("li",{children:n.jsx(ce,{item:l,short:!0})},l._id))})]})]}),x&&s?.length===0?n.jsx("p",{children:"No results"}):n.jsxs("section",{className:A.productSection,children:[n.jsx("button",{type:"submit",onClick:()=>q(!0),title:"Add Product",children:"+ Add Product"}),n.jsx("ul",{className:A.productsList,children:s?.map(l=>n.jsx("li",{children:n.jsx(ce,{item:l})},l._id))})]})]}),J&&n.jsxs(se,{onClose:()=>q(!1),children:[n.jsx(n.Fragment,{}),n.jsx(pe,{onClose:()=>q(!1),refetch:o})]})]})};export{De as default};
